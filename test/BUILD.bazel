genrule(
    name = 'foo',
    srcs = [ 'bar.py' ],
    outs = [ 'foo.py' ],
    cmd_bash = '$(location doit.sh) $(location bar.py) $(location foo.py)',
    message = "well well",
    tools = [
        'doit.sh'
    ],
)

py_binary(
    name = 'test',
    srcs = [
        'test.py',
        'foo.py',
    ],
    deps = [
    ]
)
